<div class="p-2 p-lg-4">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <input type="text" placeholder="Chercher" [(ngModel)]="search" (ngModelChange)="searchSubject.next($event)" class="form-control" id="searchProd">
    </div>

    <app-invoice-create
      [reference]="reference"
      [publicId]="publicId"
      (createDraft)="createDraftInvoice()"
      (refresh)="refresh()"
      class="ms-auto">
    </app-invoice-create>
  </div>
  <div class="mt-3">
    <app-invoice-update
      [show]="showUpdate"
      [savedInvoice]="invoiceToUpdate"
      [readOnly]="readOnly"
      (refresh)="refresh()"
      class="ms-auto">
    </app-invoice-update>
    <table *ngIf="invoices | async as invoiceData" class="table">
      <thead>
      <tr>
        <th scope="col">Réference</th>
        <th scope="col">Date</th>
        <th scope="col">Client</th>
        <th scope="col">Actions</th>
      </tr>
      </thead>
      <tbody *ngIf="invoiceCount > 0">
      <tr *ngFor="let item of invoiceData">
        <td>{{item.reference}}</td>
        <td>{{item.creationDate | date: 'dd/MM/yyyy'}}</td>
        <td>{{item.client.name}}</td>
        <td>
          <span class="d-inline-block" tabindex="0" data-toggle="tooltip" title="Modifier">
            <i (click)="update(item)" class="bi bi-pencil-square h4 me-2"></i>
          </span>
<!--          <span class="d-inline-block" tabindex="0" data-toggle="tooltip" title="Ouvrir en lecture seule">-->
<!--            <i *ngIf="item.closed" (click)="readOnlyMode(item)"class="bi bi-bag-check-fill h4 me-2"></i>-->
<!--          </span>-->
<!--          <span class="d-inline-block" tabindex="0" data-toggle="tooltip" title="Fermer Facture/BL">-->
<!--            <i *ngIf="!item.closed" (click)="closeComponent?.openCloseModal(item)" class="bi bi-database-check h4 me-2"></i>-->
<!--          </span>-->
          <span class="d-inline-block" tabindex="0" data-toggle="tooltip" title="Générer une BL">
            <i (click)="blToToExport = item" class="bi bi-download h4 me-2" data-bs-toggle="modal" data-bs-target="#confirmBl"></i>
          </span>
          <span class="d-inline-block" tabindex="0" data-toggle="tooltip"  title="Générer une Facture">
            <i (click)="invoiceToExport = item" class="bi bi-cloud-download h4" data-bs-toggle="modal" data-bs-target="#confirmInvoice"></i>
          </span>
        </td>
      </tr>
      </tbody>
    </table>
    <app-placeholder [isLoading]="isLoading"></app-placeholder>
    <app-pagination [count]="invoiceCount" (selectPage)="changePage($event)"></app-pagination>
    <app-close (validClose)="validClose($event)"></app-close>
    <h6 class="d-flex mt-5 justify-content-center" *ngIf="invoiceCount === 0 && !isLoading">Aucune facture trouvée</h6>
  </div>
</div>

<div class="modal fade" id="confirmBl" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        Etes vous sure de générer le bon de livraison :  <strong>{{blToToExport.reference}}</strong>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Fermer</button>
        <button type="button" class="btn btn-sm btn-success" data-bs-dismiss="modal" (click)="exportIBl()">Générer</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="confirmInvoice" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        Etes vous sure de générer la facture <strong>{{invoiceToExport.reference}}</strong>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Fermer</button>
        <button type="button" class="btn btn-sm btn-success" data-bs-dismiss="modal" (click)="exportInvoice()">Générer</button>
      </div>
    </div>
  </div>
</div>
